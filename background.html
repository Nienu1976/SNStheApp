import React, { useState, useEffect } from 'react';
import { Download, Layout, Palette, Settings, Layers, Zap, Cpu, Activity } from 'lucide-react';

/**
 * メインアプリケーション
 * 背景のサイズを 540x960 に固定し、文字を排除したサイバーデザインを提供します。
 */
const App = () => {
  // 設定状態（色や模様の濃さをここで管理します）
  const [config, setConfig] = useState({
    baseColor: '#020617',     // ベース（黒に近い深い青）
    cornerColor: '#3b82f6',   // 四隅の色（ここを変えると角の光が変わります）
    accentColor: '#00ffff',   // 発光アクセント（中央のリングなどの色）
    pattern: 'hex-hive',      // 背景の模様（ヘキサゴンか回路基板）
    intensity: 0.6,           // 四隅の色の強さ
    techLevel: 0.8,           // 装飾パーツの表示密度
  });

  // フォントの読み込み（近未来的なデザインのフォントを使用）
  useEffect(() => {
    const link = document.createElement('link');
    link.href = 'https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&family=Rajdhani:wght@500;700&family=Share+Tech+Mono&display=swap';
    link.rel = 'stylesheet';
    document.head.appendChild(link);
  }, []);

  // 設定を変更するための関数
  const handleChange = (key, value) => {
    setConfig(prev => ({ ...prev, [key]: value }));
  };

  /**
   * 背景パネルコンポーネント
   * サイズ: 540px * 960px 固定
   */
  const CyberBackground = () => {
    const { baseColor, cornerColor, accentColor, pattern, intensity, techLevel } = config;

    // 背景の模様（パターン）を描画する関数
    const renderPattern = () => {
      const opacity = techLevel * 0.1;
      if (pattern === 'hex-hive') {
        return (
          <div className="absolute inset-0" 
            style={{
              backgroundImage: `url("data:image/svg+xml,%3Csvg width='56' height='100' viewBox='0 0 56 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M28 66L0 50L0 16L28 0L56 16L56 50L28 66L28 100' fill='none' stroke='%23ffffff' stroke-width='1'/%3E%3Cpath d='M28 0L28 33L0 50L0 84L28 100L56 84L56 50L28 33' fill='%23ffffff' fill-opacity='0.05'/%3E%3C/svg%3E")`,
              opacity: opacity
            }}
          />
        );
      } else if (pattern === 'circuit-board') {
         return (
          <div className="absolute inset-0" 
            style={{
              backgroundImage: `linear-gradient(rgba(255,255,255,0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.05) 1px, transparent 1px)`,
              backgroundSize: '20px 20px',
              opacity: opacity * 1.5
            }}
          >
             <svg className="absolute w-full h-full opacity-20" viewBox="0 0 100 100" preserveAspectRatio="none">
                <path d="M0 20 H30 L40 30 H100" stroke="white" fill="none" vectorEffect="non-scaling-stroke" />
                <path d="M0 80 H60 L70 70 H100" stroke="white" fill="none" vectorEffect="non-scaling-stroke" />
                <path d="M50 0 V100" stroke="white" fill="none" strokeDasharray="5 5" vectorEffect="non-scaling-stroke" />
             </svg>
          </div>
        );
      }
      return null;
    };

    // CSS変数を設定（色をパーツに反映させるため）
    const styleVars = {
      '--base': baseColor,
      '--corner': cornerColor,
      '--accent': accentColor,
      '--intensity': intensity,
    };

    return (
      <div 
        id="cyber-panel-root"
        className="relative w-[540px] h-[960px] bg-[var(--base)] overflow-hidden shadow-2xl font-[Orbitron] text-white"
        style={styleVars}
      >
        {/* 1. 雰囲気作り（中心を暗く、ノイズ感を出す） */}
        <div className="absolute inset-0 bg-gradient-to-b from-transparent via-[#00000055] to-transparent">
            <div className="absolute inset-0 bg-[radial-gradient(circle_at_center,transparent_40%,#000000_100%)] opacity-80"></div>
            <div className="absolute inset-0 opacity-[0.15] mix-blend-overlay" style={{backgroundImage: `url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.6' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E")`}}></div>
        </div>

        {/* 2. 四隅からの光（ここで指定した色が角から漏れます） */}
        <div 
            className="absolute inset-0 pointer-events-none mix-blend-screen opacity-[var(--intensity)]"
            style={{
                background: `
                    radial-gradient(circle at 0% 0%, var(--corner), transparent 45%),
                    radial-gradient(circle at 100% 0%, var(--corner), transparent 45%),
                    radial-gradient(circle at 0% 100%, var(--corner), transparent 45%),
                    radial-gradient(circle at 100% 100%, var(--corner), transparent 45%)
                `
            }}
        ></div>

        {/* 3. 背景模様レイヤー */}
        {renderPattern()}

        {/* 4. メカニカルな装飾パーツ */}
        
        {/* 上部パーツ */}
        <div className="absolute top-0 left-0 w-full h-[180px] z-10 pointer-events-none">
            <svg width="100%" height="100%" viewBox="0 0 540 180" preserveAspectRatio="none">
                <defs>
                    <linearGradient id="dark-metal-grad" x1="0" y1="0" x2="0" y2="1">
                        <stop offset="0%" stopColor="#1e293b" />
                        <stop offset="50%" stopColor="#0f172a" />
                        <stop offset="100%" stopColor="#020617" />
                    </linearGradient>
                    <filter id="glow-s">
                        <feGaussianBlur stdDeviation="2.5" result="coloredBlur"/>
                        <feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge>
                    </filter>
                </defs>
                <path d="M0 0 H540 V100 L480 140 H60 L0 100 Z" fill="url(#dark-metal-grad)" stroke="#334155" strokeWidth="1" fillOpacity="0.95" filter="drop-shadow(0px 4px 10px rgba(0,0,0,0.8))" />
                <path d="M20 110 L60 150 H480 L520 110" fill="none" stroke="var(--accent)" strokeWidth="2" filter="url(#glow-s)" />
                <rect x="240" y="120" width="60" height="2" fill="var(--accent)" filter="url(#glow-s)" />
                <g fill="var(--corner)" fillOpacity="0.8">
                    <rect x="70" y="145" width="20" height="4" />
                    <rect x="95" y="145" width="20" height="4" />
                    <rect x="120" y="145" width="20" height="4" />
                </g>
                <g fill="var(--corner)" fillOpacity="0.8" transform="scale(-1, 1) translate(-540, 0)">
                    <rect x="70" y="145" width="20" height="4" />
                    <rect x="95" y="145" width="20" height="4" />
                    <rect x="120" y="145" width="20" height="4" />
                </g>
            </svg>
            {/* 上部のスキャンラインアニメーション */}
            <div className="absolute top-[138px] left-[60px] right-[60px] h-[1px] bg-[var(--accent)] shadow-[0_0_8px_var(--accent)] animate-scan-h opacity-70"></div>
        </div>

        {/* 左右の柱状装飾 */}
        <div className="absolute top-[180px] bottom-[180px] left-0 w-8 bg-gradient-to-r from-black to-transparent border-r border-gray-800/50">
            <div className="h-full w-full flex flex-col justify-around py-10 items-center opacity-30">
                 {[...Array(10)].map((_,i) => <div key={i} className="w-1 h-8 bg-gray-600"></div>)}
            </div>
        </div>
        <div className="absolute top-[180px] bottom-[180px] right-0 w-8 bg-gradient-to-l from-black to-transparent border-l border-gray-800/50">
            <div className="h-full w-full flex flex-col justify-around py-10 items-center opacity-30">
                 {[...Array(10)].map((_,i) => <div key={i} className="w-1 h-8 bg-gray-600"></div>)}
            </div>
        </div>

        {/* 中央の回転するギミック */}
        <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 pointer-events-none">
            <div className="w-[480px] h-[480px] rounded-full border border-white/10 opacity-50 animate-spin-super-slow flex items-center justify-center">
                <div className="w-[470px] h-[470px] rounded-full border border-dashed border-white/20"></div>
            </div>
            <div className="absolute top-0 left-0 w-[480px] h-[480px] flex items-center justify-center animate-spin-slow">
                 <div className="absolute top-0 w-2 h-12 bg-[var(--accent)] shadow-[0_0_15px_var(--accent)]"></div>
                 <div className="absolute bottom-0 w-2 h-12 bg-[var(--accent)] shadow-[0_0_15px_var(--accent)]"></div>
            </div>
             <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-[300px] h-[300px] opacity-40 mix-blend-screen">
                 <svg viewBox="0 0 100 100" className="w-full h-full animate-pulse">
                     <path d="M50 0 L93 25 V75 L50 100 L7 75 V25 Z" fill="none" stroke="var(--corner)" strokeWidth="1" />
                     <path d="M50 10 L85 30 V70 L50 90 L15 70 V30 Z" fill="none" stroke="var(--corner)" strokeWidth="0.5" />
                     <path d="M40 50 H60 M50 40 V60" stroke="white" strokeWidth="0.5" />
                 </svg>
             </div>
        </div>

        {/* 下部パーツ */}
        <div className="absolute bottom-0 left-0 w-full h-[160px] z-10 pointer-events-none">
            <svg width="100%" height="100%" viewBox="0 0 540 160" preserveAspectRatio="none">
                <path d="M0 160 H540 V60 L500 20 H40 L0 60 Z" fill="url(#dark-metal-grad)" stroke="#334155" strokeWidth="1" fillOpacity="0.95" filter="drop-shadow(0px -4px 10px rgba(0,0,0,0.8))" />
                <path d="M40 25 H500" stroke="var(--accent)" strokeWidth="2" filter="url(#glow-s)" />
                <rect x="40" y="70" width="120" height="60" fill="none" stroke="#475569" strokeWidth="1" />
                <path d="M40 70 L50 80 H150 L160 70" fill="#334155" opacity="0.3" />
                <rect x="380" y="70" width="120" height="60" fill="none" stroke="#475569" strokeWidth="1" />
                <g transform="translate(390, 85)">
                     <rect width="100" height="4" fill="#334155" />
                     <rect width="70" height="4" fill="var(--corner)" />
                </g>
            </svg>
        </div>

        {/* 全体に走る走査線ノイズ */}
        <div className="absolute inset-0 pointer-events-none opacity-20 bg-[linear-gradient(rgba(0,0,0,0)_50%,rgba(0,0,0,0.5)_50%),linear-gradient(90deg,rgba(255,0,0,0.06),rgba(0,255,0,0.02),rgba(0,0,255,0.06))] bg-[length:100%_4px,3px_100%]"></div>

        <style>{`
          .animate-spin-super-slow { animation: spin 60s linear infinite; }
          .animate-spin-slow { animation: spin 10s linear infinite; }
          .animate-scan-h { animation: scan-h 3s ease-in-out infinite alternate; }
          @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
          @keyframes scan-h { from { left: 60px; right: 420px; opacity: 0.2; } to { left: 420px; right: 60px; opacity: 1; } }
        `}</style>
      </div>
    );
  };

  // ----------------------------------------------------------------
  // 操作用 UI
  // ----------------------------------------------------------------
  return (
    <div className="min-h-screen bg-[#000000] text-white flex p-4 gap-8 font-sans">
      
      {/* 設定パネル */}
      <div className="w-96 bg-[#111111] p-6 rounded-none border-l-4 border-cyan-500 shadow-2xl h-fit sticky top-4">
        <div className="mb-8 pb-4 border-b border-gray-800 flex justify-between items-end">
          <div>
            <h1 className="text-2xl font-black italic tracking-tighter font-[Orbitron] text-cyan-400">
              MECHA_GEN
            </h1>
            <p className="text-[10px] text-gray-500 font-mono tracking-widest">DARK_CORE_EDITOR v5.0</p>
          </div>
          <Cpu className="text-gray-700 animate-pulse" />
        </div>

        <div className="space-y-8">
          <div className="space-y-4">
            <label className="text-xs font-bold text-cyan-500 tracking-widest flex items-center gap-2 uppercase">
              <Layers className="w-3 h-3" /> Corner Ambience (四隅の色)
            </label>
            <div className="flex gap-2 items-center bg-black/30 p-2 rounded border border-gray-800">
              <input 
                type="color" 
                value={config.cornerColor} 
                onChange={(e) => handleChange('cornerColor', e.target.value)}
                className="w-8 h-8 rounded-sm cursor-pointer border-none bg-transparent"
              />
              <span className="font-mono text-xs text-gray-500">{config.cornerColor}</span>
              <div className="flex-1 h-1 bg-gray-800 ml-2 rounded overflow-hidden">
                  <div className="h-full bg-[var(--cornerColor)]" style={{width: '100%', backgroundColor: config.cornerColor, boxShadow: `0 0 10px ${config.cornerColor}`}}></div>
              </div>
            </div>
          </div>

          <div className="space-y-4">
            <label className="text-xs font-bold text-cyan-500 tracking-widest flex items-center gap-2 uppercase">
              <Zap className="w-3 h-3" /> UI Glow (発光色)
            </label>
            <div className="flex gap-2 items-center bg-black/30 p-2 rounded border border-gray-800">
              <input 
                type="color" 
                value={config.accentColor} 
                onChange={(e) => handleChange('accentColor', e.target.value)}
                className="w-8 h-8 rounded-sm cursor-pointer border-none bg-transparent"
              />
              <span className="font-mono text-xs text-gray-500">{config.accentColor}</span>
              <div className="flex-1 h-1 bg-gray-800 ml-2 rounded overflow-hidden">
                  <div className="h-full bg-[var(--accentColor)]" style={{width: '100%', backgroundColor: config.accentColor, boxShadow: `0 0 10px ${config.accentColor}`}}></div>
              </div>
            </div>
          </div>

          <div className="space-y-6 pt-4 border-t border-gray-800">
             <div className="space-y-2">
                <div className="flex justify-between text-xs font-mono text-gray-500">
                    <span>CORNER_INTENSITY (光の強さ)</span>
                    <span>{Math.round(config.intensity * 100)}%</span>
                </div>
                <input 
                    type="range" min="0" max="1" step="0.05"
                    value={config.intensity}
                    onChange={(e) => handleChange('intensity', parseFloat(e.target.value))}
                    className="w-full h-1 bg-gray-800 rounded-none appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-4 [&::-webkit-slider-thumb]:h-4 [&::-webkit-slider-thumb]:bg-cyan-500"
                />
             </div>
             <div className="space-y-2">
                <div className="flex justify-between text-xs font-mono text-gray-500">
                    <span>DETAIL_DENSITY (飾りの多さ)</span>
                    <span>{Math.round(config.techLevel * 100)}%</span>
                </div>
                <input 
                    type="range" min="0" max="1" step="0.05"
                    value={config.techLevel}
                    onChange={(e) => handleChange('techLevel', parseFloat(e.target.value))}
                    className="w-full h-1 bg-gray-800 rounded-none appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-4 [&::-webkit-slider-thumb]:h-4 [&::-webkit-slider-thumb]:bg-cyan-500"
                />
             </div>
          </div>

          <div className="space-y-3 pt-4 border-t border-gray-800">
             <label className="text-xs font-bold text-cyan-500 tracking-widest uppercase">Structural Pattern (模様)</label>
             <div className="grid grid-cols-2 gap-2">
                 {['hex-hive', 'circuit-board'].map(p => (
                     <button 
                        key={p}
                        onClick={() => handleChange('pattern', p)}
                        className={`text-xs py-2 border font-mono transition-all ${config.pattern === p ? 'border-cyan-500 bg-cyan-900/30 text-white' : 'border-gray-800 text-gray-600 hover:border-gray-600'}`}
                     >
                         {p.toUpperCase()}
                     </button>
                 ))}
             </div>
          </div>
          
          <div className="pt-6 border-t border-gray-800">
              <div className="text-[10px] text-gray-600 font-mono">
                SIZE_INFO: 540 x 960 (VERTICAL)<br/>
                STATUS: READY_FOR_EXPORT
              </div>
          </div>

        </div>
      </div>

      {/* プレビュー表示エリア */}
      <div className="flex-1 flex justify-center items-start pt-10 overflow-auto bg-[radial-gradient(#222_1px,transparent_1px)] bg-[size:20px_20px]">
        <div className="relative group p-4 border border-white/5 bg-black/40">
            <CyberBackground />
            <div className="absolute -right-16 top-0 flex flex-col gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
                <button className="p-3 bg-white text-black rounded-full shadow-lg hover:scale-110 transition-transform">
                    <Download className="w-6 h-6" />
                </button>
            </div>
            {/* サイズガイド */}
            <div className="absolute -bottom-6 left-0 text-[10px] text-gray-500 font-mono">
              OUTPUT_DIMENSIONS: 540px * 960px
            </div>
        </div>
      </div>

    </div>
  );
};

export default App;
